<!DOCTYPE html>
<html lang="en" ng-app="ChatApp">
    <head>
        <meta charset="utf-8">
        <title>Chat</title>
        <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/0.10.0/angular-material.min.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="style.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.1/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.1/angular-animate.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.1/angular-aria.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angular_material/0.10.1/angular-material.min.js"></script>
        <script src="js/main.js"></script>
    </head>
    <body ng-controller="ChatController">
        <md-toolbar>
            <div class="md-toolbar-tools">
                <h3>
                    The Magic Chat App
                </h3>
            </div>
        </md-toolbar>
        <md-button ng-hide="loggedIn" class="md-raised md-primary" href="{{loginUri}}">Log in</md-button>
        <md-content ng-show="loggedIn">
            <md-tabs class="md-primary" md-selected="selectedTab" md-dynamic-height>
                <md-tab label="Chat">
                    <md-button class="md-raised md-accent" ng-hide="desktopNotifications" ng-click="setUpNotifications()">
                        Enable Desktop Notifications
                    </md-button>
                    <md-list>
                        <md-subheader class="md-accent">Users</md-subheader>
                        <md-list-item ng-repeat="user in users" ng-click="addChat(user)">
                            <img class="md-avatar" src="{{user.avatarUrl}}"/>
                            <p>{{user.name || user.id}}</p>
                            <md-icon class="material-icons" ng-class="{'md-primary': chatHasUnreadMessages(user)}">message</md-icon>
                            <md-divider></md-divider>
                        </md-list-item>
                    </md-list>
                </md-tab>
                <md-tab ng-repeat="chat in activeChats" label="{{chat.user.name || chat.user.id}}">
                    <md-progress-circular md-mode="indeterminate" ng-show="chat.isLoading"></md-progress-circular>
                    <md-list>
                        <md-list-item ng-repeat="message in chat.messages">
                            <img src="{{message.from.avatarUrl}}" class="md-avatar" alt="{{message.from.name || message.from.id}}" />
                            <b>{{message.from.name || message.from.id}}:</b> {{message.body}}
                        </md-list-item>
                    </md-list>

                    <form ng-submit="sendMessage(chat)">
                        <md-input-container>
                            <label>Message</label>
                            <input ng-model="chat.currentlyTypedMessage" name="typedMessage" />
                        </md-input-container>
                    </form>
                </md-tab>
            </md-tabs>
        </md-content>
    </body>
</html>